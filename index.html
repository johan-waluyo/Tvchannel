<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My TV Channel - IPTV Player</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background: #f3f6fa; }
    header, footer {
      background: #0a1b5c;
      color: #fff;
      padding: 16px 0;
      text-align: center;
    }
    nav a {
      color: #ffd700;
      text-decoration: none;
      margin: 0 12px;
      font-weight: bold;
      transition: color 0.2s;
    }
    nav a:hover {
      color: #ffa500;
      text-decoration: underline;
    }
    .container {
      display: flex;
      max-width: 1100px;
      margin: 32px auto 24px auto;
      padding: 0 16px;
      gap: 24px;
    }
    .main-content {
      flex: 2;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 8px #0001;
      padding: 24px 20px;
    }
    .sidebar {
      flex: 1;
      background: #f8fbff;
      border-radius: 8px;
      box-shadow: 0 2px 8px #0001;
      padding: 24px 20px;
      min-width: 270px;
      max-width: 360px;
    }
    h1 {
      margin: 0 0 4px 0;
      font-size: 2em;
      letter-spacing: 1px;
    }
    h2 {
      font-size: 1.45em;
      margin-top: 0;
    }
    label, select, input, button {
      font-size: 1em;
      margin-bottom: 6px;
    }
    select, input[type="text"] {
      padding: 5px 7px;
    }
    #channelSelect {
      width: 90%;
      margin-bottom: 12px;
    }
    #video {
      width: 100%;
      max-width: 700px;
      height: 360px;
      background: #111;
      margin-bottom: 10px;
      border-radius: 4px;
      display: block;
    }
    .channelUrlBoxWrapper {
      margin-top: 7px;
    }
    #channelUrlBox {
      width: 67%;
      font-size: 0.98em;
      margin-right: 6px;
      padding: 4px 5px;
      border-radius: 4px;
      border: 1px solid #bbb;
      background: #f8f8f8;
    }
    button {
      background: #0a1b5c;
      color: #fff;
      padding: 6px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover { background: #2444a7; }
    @media (max-width: 1000px) {
      .container { flex-direction: column; }
      .sidebar { max-width: 100%; min-width: 0; margin-top: 24px; }
      #video { height: 220px; }
    }
    @media (max-width: 500px) {
      .main-content, .sidebar { padding: 16px 6px; }
      #video { height: 140px; }
    }
  </style>
</head>
<body>

<!-- Header & Navigation -->
<header>
  <h1>TV Channel</h1>
  <!--<nav>
    <a href="index.html">Home</a>
    <a href="jadwal.html">Jadwal</a>
    <a href="id.html">IPTV</a>
  </nav>-->
</header>

<!-- Main Container (Content & Sidebar) -->
<div class="container">
  <div class="main-content">
    <h2>TV Channel</h2>

    <label for="regionSelect"><b>Region:</b></label>
    <select id="regionSelect">
      <option value="all">ALL</option>
      <option value="sg">Singapore</option>
      <option value="my">Malaysia</option>
      <option value="id" selected>Indonesia</option>
      <option value="tw">Taiwan</option>
      <option value="cn">China</option>
      <option value="vn">Vietnam</option>
      <option value="kh">Cambodia</option>
    </select>
    <br><br>

    <input type="text" id="searchBox" placeholder="Search channel name..." style="width:80%">
    <br><br>

    <select id="channelSelect"></select>
    <br><br>

    <video id="video" controls></video>
    <br>
    <div class="channelUrlBoxWrapper">
      Channel Stream URL: <br>
      <input type="text" id="channelUrlBox" readonly>
      <button onclick="copyUrl()">Copy</button>
    </div>
  </div>

  <!-- Sidebar Donasi Saweria -->
  <div class="sidebar">
    <h3>Dukung Channel!</h3>
    <iframe src="https://saweria.co/widget/donate/NAMA_SAWERIA"
            style="border:none;width:100%;height:250px;border-radius:8px;margin-bottom:10px;"></iframe>
    <p>Scan QR atau klik tombol di bawah ini:</p>
    <a href="https://saweria.co/NAMA_SAWERIA" target="_blank"
       style="display:inline-block;background:orange;color:white;padding:12px 28px;font-size:1.1em;border-radius:6px;text-decoration:none;">Donasi ke Saweria</a>
    <hr style="margin:22px 0 10px;">
    <p style="font-size:0.98em;color:#555;">
      <b>Tips:</b> Jika streaming tidak berjalan, coba pilih channel lain atau region berbeda.<br>
      <b>Butuh channel favorit?</b> Request via DM IG kami!
    </p>
  </div>
</div>

<!-- Footer -->
<footer>
  &copy; 2024 My TV Channel &mdash; Follow us:
  <a style="color:#ffd700;" href="https://instagram.com/johanwaluyo" target="_blank">Instagram</a>
</footer>

<!-- IPTV Channel JS -->
<script>
const regionM3uUrls = {
  all: 'https://iptv-org.github.io/iptv/index.m3u',
  sg:  'https://raw.githubusercontent.com/iptv-org/iptv/master/streams/sg.m3u',
  my:  'https://raw.githubusercontent.com/iptv-org/iptv/master/streams/my.m3u',
  id:  'https://raw.githubusercontent.com/iptv-org/iptv/master/streams/id.m3u',
  tw:  'https://raw.githubusercontent.com/iptv-org/iptv/master/streams/tw.m3u',
  cn:  'https://raw.githubusercontent.com/iptv-org/iptv/master/streams/cn.m3u',
  vn:  'https://raw.githubusercontent.com/iptv-org/iptv/master/streams/vn.m3u',
  kh:  'https://raw.githubusercontent.com/iptv-org/iptv/master/streams/kh.m3u'
};

let allChannels = []; // master channel list

// Fetch/parse .m3u file
async function fetchAndParseM3U(url) {
    const response = await fetch(url);
    const text = await response.text();

    const lines = text.split('\n');
    const channels = [];
    let currentName = '';
    for (const line of lines) {
        if (line.startsWith('#EXTINF')) {
            let match = line.match(/tvg-name="([^"]+)"/);
            if (match) {
                currentName = match[1];
            } else {
                let commaIndex = line.indexOf(',');
                currentName = (commaIndex !== -1) ? line.substr(commaIndex + 1).trim() : 'Unknown Channel';
            }
        }
        else if (line && !line.startsWith('#')) {
            channels.push({ name: currentName, url: line });
            currentName = '';
        }
    }
    return channels;
}

function loadChannels(channels, autoPlay = true) {
    const select = document.getElementById('channelSelect');
    select.innerHTML = '';
    channels.forEach((ch, idx) => {
        const option = document.createElement('option');
        option.value = idx;
        option.textContent = ch.name;
        select.appendChild(option);
    });

    select.onchange = () => playChannel(channels[select.value].url);
    if (channels.length > 0 && autoPlay) {
        select.selectedIndex = 0;
        playChannel(channels[0].url);
    } else {
        document.getElementById('channelUrlBox').value = '';
        const video = document.getElementById('video');
        if (window.hls) window.hls.destroy();
        video.src = '';
    }
}

function playChannel(streamUrl) {
    const video = document.getElementById('video');
    document.getElementById('channelUrlBox').value = streamUrl;
    if (Hls.isSupported()) {
        if (window.hls) window.hls.destroy();
        window.hls = new Hls();
        window.hls.loadSource(streamUrl);
        window.hls.attachMedia(video);
    } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
        video.src = streamUrl;
    }
}

// Search/filter for current channel list
document.getElementById('searchBox').addEventListener('input', function () {
    const keyword = this.value.toLowerCase();
    const filtered = allChannels.filter(ch => ch.name.toLowerCase().includes(keyword));
    loadChannels(filtered, false);
});

function copyUrl() {
    const urlBox = document.getElementById('channelUrlBox');
    urlBox.select();
    urlBox.setSelectionRange(0, 99999);
    document.execCommand('copy');
}

// When region changes, fetch and update channel list
document.getElementById('regionSelect').addEventListener('change', function() {
    const region = this.value;
    const url = regionM3uUrls[region] || regionM3uUrls['id'];
    document.getElementById('searchBox').value = '';
    fetchAndParseM3U(url).then(channels => {
        allChannels = channels;
        loadChannels(allChannels);
    });
});

// Initial load: Indonesia by default
window.addEventListener('DOMContentLoaded', function() {
    document.getElementById('regionSelect').value = 'id';
    const url = regionM3uUrls['id'];
    fetchAndParseM3U(url).then(channels => {
        allChannels = channels;
        loadChannels(allChannels);
    });
});
</script>
</body>
</html>
